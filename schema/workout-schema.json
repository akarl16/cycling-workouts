{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Cycling Workout",
  "description": "A cycling workout with intervals and optional repeating blocks",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for the workout"
    },
    "name": {
      "type": "string",
      "description": "Display name of the workout",
      "minLength": 1
    },
    "description": {
      "type": "string",
      "description": "Optional description of the workout"
    },
    "totalDuration": {
      "type": "integer",
      "description": "Total duration of the workout in seconds"
    },
    "intervals": {
      "type": "array",
      "description": "Array of workout intervals (legacy format - use sequence instead)",
      "items": {
        "$ref": "#/definitions/WorkoutInterval"
      }
    },
    "blocks": {
      "type": "array",
      "description": "Optional array of repeating interval blocks (legacy format - use sequence instead)",
      "items": {
        "$ref": "#/definitions/WorkoutBlock"
      }
    },
    "sequence": {
      "type": "array",
      "description": "New format: Mixed array of intervals and blocks in execution order",
      "items": {
        "oneOf": [
          {
            "$ref": "#/definitions/SequenceInterval"
          },
          {
            "$ref": "#/definitions/SequenceBlock"
          }
        ]
      }
    },
    "isSample": {
      "type": "boolean",
      "description": "Whether this is a sample workout"
    }
  },
  "required": [
    "id",
    "name"
  ],
  "oneOf": [
    {
      "required": ["intervals"],
      "description": "Legacy format with intervals array"
    },
    {
      "required": ["sequence"],
      "description": "New format with sequence array"
    }
  ],
  "additionalProperties": false,
  "definitions": {
    "WorkoutInterval": {
      "type": "object",
      "description": "Individual workout interval with power zone and cadence targets",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the interval"
        },
        "name": {
          "type": "string",
          "description": "Display name of the interval",
          "minLength": 1
        },
        "duration": {
          "type": "integer",
          "description": "Duration in seconds",
          "minimum": 1
        },
        "powerZone": {
          "oneOf": [
            {
              "type": "integer",
              "description": "Power zone as number (1-7)",
              "minimum": 1,
              "maximum": 7
            },
            {
              "type": "string",
              "description": "Power zone with optional modifier (e.g., 'Z2+', '3-', 'Zone 4+')",
              "pattern": "^(?:[Zz](?:one)?\\s*)?[1-7][+-]?$"
            }
          ]
        },
        "powerZoneRange": {
          "type": "object",
          "description": "Optional power zone range for gradual progression through zones",
          "properties": {
            "start": {
              "oneOf": [
                {
                  "type": "integer",
                  "description": "Starting power zone as number (1-7)",
                  "minimum": 1,
                  "maximum": 7
                },
                {
                  "type": "string",
                  "description": "Starting power zone with optional modifier",
                  "pattern": "^(?:[Zz](?:one)?\\s*)?[1-7][+-]?$"
                }
              ]
            },
            "end": {
              "oneOf": [
                {
                  "type": "integer",
                  "description": "Ending power zone as number (1-7)",
                  "minimum": 1,
                  "maximum": 7
                },
                {
                  "type": "string",
                  "description": "Ending power zone with optional modifier",
                  "pattern": "^(?:[Zz](?:one)?\\s*)?[1-7][+-]?$"
                }
              ]
            }
          },
          "required": ["start", "end"],
          "additionalProperties": false
        },
        "cadence": {
          "type": "integer",
          "description": "Target cadence in RPM",
          "minimum": 40,
          "maximum": 150
        },
        "alternating": {
          "type": "object",
          "description": "Optional alternating interval configuration - allows switching between two power zones",
          "properties": {
            "powerZoneA": {
              "oneOf": [
                {
                  "type": "integer",
                  "description": "First power zone as number (1-7)",
                  "minimum": 1,
                  "maximum": 7
                },
                {
                  "type": "string",
                  "description": "First power zone with optional modifier (e.g., 'Z2+', '3-', 'Zone 4+')",
                  "pattern": "^(?:[Zz](?:one)?\\s*)?[1-7][+-]?$"
                }
              ]
            },
            "powerZoneB": {
              "oneOf": [
                {
                  "type": "integer",
                  "description": "Second power zone as number (1-7)",
                  "minimum": 1,
                  "maximum": 7
                },
                {
                  "type": "string",
                  "description": "Second power zone with optional modifier (e.g., 'Z2+', '3-', 'Zone 4+')",
                  "pattern": "^(?:[Zz](?:one)?\\s*)?[1-7][+-]?$"
                }
              ]
            },
            "cadenceA": {
              "type": "integer",
              "description": "Target cadence for power zone A in RPM",
              "minimum": 40,
              "maximum": 150
            },
            "cadenceB": {
              "type": "integer",
              "description": "Target cadence for power zone B in RPM",
              "minimum": 40,
              "maximum": 150
            },
            "startWithZone": {
              "type": "string",
              "description": "Which zone to start with",
              "enum": [
                "A",
                "B"
              ],
              "default": "A"
            }
          },
          "required": [
            "powerZoneA",
            "powerZoneB"
          ],
          "additionalProperties": false
        }
      },
      "required": [
        "id",
        "name",
        "duration"
      ],
      "oneOf": [
        {
          "required": ["powerZone"]
        },
        {
          "required": ["powerZoneRange"]
        }
      ],
      "additionalProperties": false
    },
    "WorkoutBlock": {
      "type": "object",
      "description": "Repeating block of intervals",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the block"
        },
        "name": {
          "type": "string",
          "description": "Display name of the block",
          "minLength": 1
        },
        "repetitions": {
          "type": "integer",
          "description": "Number of times to repeat the block",
          "minimum": 1
        },
        "intervals": {
          "type": "array",
          "description": "Intervals within the block",
          "items": {
            "$ref": "#/definitions/WorkoutInterval"
          },
          "minItems": 1
        }
      },
      "required": [
        "id",
        "name",
        "repetitions",
        "intervals"
      ],
      "additionalProperties": false
    },
    "SequenceInterval": {
      "type": "object",
      "description": "Interval in a sequence (with type discriminator)",
      "properties": {
        "type": {
          "type": "string",
          "const": "interval",
          "description": "Type discriminator for mixed sequences"
        },
        "id": {
          "type": "string",
          "description": "Unique identifier for the interval"
        },
        "name": {
          "type": "string",
          "description": "Display name of the interval",
          "minLength": 1
        },
        "duration": {
          "type": "integer",
          "description": "Duration in seconds",
          "minimum": 1
        },
        "powerZone": {
          "oneOf": [
            {
              "type": "integer",
              "description": "Power zone as number (1-7)",
              "minimum": 1,
              "maximum": 7
            },
            {
              "type": "string",
              "description": "Power zone with optional modifier (e.g., 'Z2+', '3-', 'Zone 4+')",
              "pattern": "^(?:[Zz](?:one)?\\s*)?[1-7][+-]?$"
            }
          ]
        },
        "powerZoneRange": {
          "type": "object",
          "description": "Optional power zone range for gradual progression through zones",
          "properties": {
            "start": {
              "oneOf": [
                {
                  "type": "integer",
                  "description": "Starting power zone as number (1-7)",
                  "minimum": 1,
                  "maximum": 7
                },
                {
                  "type": "string",
                  "description": "Starting power zone with optional modifier",
                  "pattern": "^(?:[Zz](?:one)?\\s*)?[1-7][+-]?$"
                }
              ]
            },
            "end": {
              "oneOf": [
                {
                  "type": "integer",
                  "description": "Ending power zone as number (1-7)",
                  "minimum": 1,
                  "maximum": 7
                },
                {
                  "type": "string",
                  "description": "Ending power zone with optional modifier",
                  "pattern": "^(?:[Zz](?:one)?\\s*)?[1-7][+-]?$"
                }
              ]
            }
          },
          "required": ["start", "end"],
          "additionalProperties": false
        },
        "cadence": {
          "type": "integer",
          "description": "Target cadence in RPM",
          "minimum": 40,
          "maximum": 150
        },
        "alternating": {
          "type": "object",
          "description": "Optional alternating interval configuration",
          "properties": {
            "powerZoneA": {
              "oneOf": [
                {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 7
                },
                {
                  "type": "string",
                  "pattern": "^(?:[Zz](?:one)?\\s*)?[1-7][+-]?$"
                }
              ]
            },
            "powerZoneB": {
              "oneOf": [
                {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 7
                },
                {
                  "type": "string",
                  "pattern": "^(?:[Zz](?:one)?\\s*)?[1-7][+-]?$"
                }
              ]
            },
            "cadenceA": {
              "type": "integer",
              "minimum": 40,
              "maximum": 150
            },
            "cadenceB": {
              "type": "integer",
              "minimum": 40,
              "maximum": 150
            },
            "startWithZone": {
              "type": "string",
              "enum": ["A", "B"],
              "default": "A"
            }
          },
          "required": ["powerZoneA", "powerZoneB"],
          "additionalProperties": false
        }
      },
      "required": [
        "type",
        "id",
        "name",
        "duration"
      ],
      "oneOf": [
        {
          "required": ["powerZone"]
        },
        {
          "required": ["powerZoneRange"]
        }
      ],
      "additionalProperties": false
    },
    "SequenceBlock": {
      "type": "object",
      "description": "Repeating block in a sequence (with type discriminator)",
      "properties": {
        "type": {
          "type": "string",
          "const": "block",
          "description": "Type discriminator for mixed sequences"
        },
        "id": {
          "type": "string",
          "description": "Unique identifier for the block"
        },
        "name": {
          "type": "string",
          "description": "Display name of the block",
          "minLength": 1
        },
        "repetitions": {
          "type": "integer",
          "description": "Number of times to repeat the block",
          "minimum": 1
        },
        "intervals": {
          "type": "array",
          "description": "Intervals within the block (no type discriminator needed inside blocks)",
          "items": {
            "$ref": "#/definitions/WorkoutInterval"
          },
          "minItems": 1
        }
      },
      "required": [
        "type",
        "id",
        "name",
        "repetitions",
        "intervals"
      ],
      "additionalProperties": false
    }
  }
}